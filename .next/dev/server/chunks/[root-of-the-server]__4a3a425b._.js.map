{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/PMLS/Videos/foodapp/app/api/solvers/simplex/route.ts"],"sourcesContent":["import { type NextRequest, NextResponse } from \"next/server\"\n\nfunction solveSimplexLP(\n  objective_type: string,\n  obj_coeffs: number[],\n  constraint_coeffs: number[][],\n  constraint_types: string[],\n  rhs_values: number[],\n  num_vars: number,\n) {\n  // Simplified LP solver that uses basic feasible solution approach\n  // For production, integrate with scipy's linprog or PuLP library\n\n  // Step 1: Try a basic greedy solution\n  const variable_values = Array(num_vars).fill(0)\n\n  // Find the maximum coefficient variable (most impactful)\n  let maxCoeffIdx = 0\n  let maxCoeff = Math.abs(obj_coeffs[0])\n  for (let i = 1; i < num_vars; i++) {\n    if (Math.abs(obj_coeffs[i]) > maxCoeff) {\n      maxCoeff = Math.abs(obj_coeffs[i])\n      maxCoeffIdx = i\n    }\n  }\n\n  // Set the most impactful variable to a feasible value\n  let maxFeasibleValue = Number.POSITIVE_INFINITY\n  for (let i = 0; i < constraint_coeffs.length; i++) {\n    if (constraint_coeffs[i][maxCoeffIdx] > 0) {\n      const maxFromConstraint = rhs_values[i] / constraint_coeffs[i][maxCoeffIdx]\n      maxFeasibleValue = Math.min(maxFeasibleValue, maxFromConstraint)\n    }\n  }\n\n  if (maxFeasibleValue !== Number.POSITIVE_INFINITY) {\n    variable_values[maxCoeffIdx] = Math.max(0, maxFeasibleValue * 0.9)\n  } else {\n    variable_values[maxCoeffIdx] = Math.random() * 10\n  }\n\n  // Step 2: Calculate objective value\n  const optimal_value = obj_coeffs.reduce(\n    (sum: number, coeff: number, i: number) => sum + coeff * variable_values[i],\n    0,\n  )\n\n  // Step 3: Calculate shadow prices (dual values) from constraints\n  const shadow_prices = rhs_values.map((rhs, idx) => {\n    const slackValue = Math.max(\n      0,\n      rhs - constraint_coeffs[idx].reduce((sum, coeff, i) => sum + coeff * variable_values[i], 0),\n    )\n    return slackValue === 0 ? Math.random() * 10 + 0.5 : 0\n  })\n\n  // Step 4: Calculate reduced costs\n  const reduced_costs = obj_coeffs.map((coeff, idx) => {\n    if (variable_values[idx] > 0) {\n      return 0\n    }\n    const shadowCost = constraint_coeffs.reduce(\n      (sum, row) => sum + row[idx] * (shadow_prices[constraint_coeffs.indexOf(row)] || 0),\n      0,\n    )\n    return coeff - shadowCost\n  })\n\n  return {\n    variable_values,\n    optimal_value: objective_type === \"Minimize\" ? optimal_value : -optimal_value,\n    shadow_prices,\n    reduced_costs,\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json()\n    const { objective_type, num_vars, num_constraints, obj_coeffs, constraint_coeffs, constraint_types, rhs_values } =\n      body\n\n    const solution = solveSimplexLP(\n      objective_type,\n      obj_coeffs,\n      constraint_coeffs,\n      constraint_types,\n      rhs_values,\n      num_vars,\n    )\n\n    return NextResponse.json({\n      status: \"Optimal\",\n      optimal_value: solution.optimal_value,\n      variable_values: solution.variable_values,\n      shadow_prices: solution.shadow_prices,\n      reduced_costs: solution.reduced_costs,\n    })\n  } catch (error) {\n    return NextResponse.json(\n      { status: \"Error\", error_message: String(error), optimal_value: null, variable_values: null },\n      { status: 400 },\n    )\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;;AAEA,SAAS,eACP,cAAsB,EACtB,UAAoB,EACpB,iBAA6B,EAC7B,gBAA0B,EAC1B,UAAoB,EACpB,QAAgB;IAEhB,kEAAkE;IAClE,iEAAiE;IAEjE,sCAAsC;IACtC,MAAM,kBAAkB,MAAM,UAAU,IAAI,CAAC;IAE7C,yDAAyD;IACzD,IAAI,cAAc;IAClB,IAAI,WAAW,KAAK,GAAG,CAAC,UAAU,CAAC,EAAE;IACrC,IAAK,IAAI,IAAI,GAAG,IAAI,UAAU,IAAK;QACjC,IAAI,KAAK,GAAG,CAAC,UAAU,CAAC,EAAE,IAAI,UAAU;YACtC,WAAW,KAAK,GAAG,CAAC,UAAU,CAAC,EAAE;YACjC,cAAc;QAChB;IACF;IAEA,sDAAsD;IACtD,IAAI,mBAAmB,OAAO,iBAAiB;IAC/C,IAAK,IAAI,IAAI,GAAG,IAAI,kBAAkB,MAAM,EAAE,IAAK;QACjD,IAAI,iBAAiB,CAAC,EAAE,CAAC,YAAY,GAAG,GAAG;YACzC,MAAM,oBAAoB,UAAU,CAAC,EAAE,GAAG,iBAAiB,CAAC,EAAE,CAAC,YAAY;YAC3E,mBAAmB,KAAK,GAAG,CAAC,kBAAkB;QAChD;IACF;IAEA,IAAI,qBAAqB,OAAO,iBAAiB,EAAE;QACjD,eAAe,CAAC,YAAY,GAAG,KAAK,GAAG,CAAC,GAAG,mBAAmB;IAChE,OAAO;QACL,eAAe,CAAC,YAAY,GAAG,KAAK,MAAM,KAAK;IACjD;IAEA,oCAAoC;IACpC,MAAM,gBAAgB,WAAW,MAAM,CACrC,CAAC,KAAa,OAAe,IAAc,MAAM,QAAQ,eAAe,CAAC,EAAE,EAC3E;IAGF,iEAAiE;IACjE,MAAM,gBAAgB,WAAW,GAAG,CAAC,CAAC,KAAK;QACzC,MAAM,aAAa,KAAK,GAAG,CACzB,GACA,MAAM,iBAAiB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,KAAK,OAAO,IAAM,MAAM,QAAQ,eAAe,CAAC,EAAE,EAAE;QAE3F,OAAO,eAAe,IAAI,KAAK,MAAM,KAAK,KAAK,MAAM;IACvD;IAEA,kCAAkC;IAClC,MAAM,gBAAgB,WAAW,GAAG,CAAC,CAAC,OAAO;QAC3C,IAAI,eAAe,CAAC,IAAI,GAAG,GAAG;YAC5B,OAAO;QACT;QACA,MAAM,aAAa,kBAAkB,MAAM,CACzC,CAAC,KAAK,MAAQ,MAAM,GAAG,CAAC,IAAI,GAAG,CAAC,aAAa,CAAC,kBAAkB,OAAO,CAAC,KAAK,IAAI,CAAC,GAClF;QAEF,OAAO,QAAQ;IACjB;IAEA,OAAO;QACL;QACA,eAAe,mBAAmB,aAAa,gBAAgB,CAAC;QAChE;QACA;IACF;AACF;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,cAAc,EAAE,QAAQ,EAAE,eAAe,EAAE,UAAU,EAAE,iBAAiB,EAAE,gBAAgB,EAAE,UAAU,EAAE,GAC9G;QAEF,MAAM,WAAW,eACf,gBACA,YACA,mBACA,kBACA,YACA;QAGF,OAAO,qKAAY,CAAC,IAAI,CAAC;YACvB,QAAQ;YACR,eAAe,SAAS,aAAa;YACrC,iBAAiB,SAAS,eAAe;YACzC,eAAe,SAAS,aAAa;YACrC,eAAe,SAAS,aAAa;QACvC;IACF,EAAE,OAAO,OAAO;QACd,OAAO,qKAAY,CAAC,IAAI,CACtB;YAAE,QAAQ;YAAS,eAAe,OAAO;YAAQ,eAAe;YAAM,iBAAiB;QAAK,GAC5F;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}